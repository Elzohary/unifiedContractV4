<mat-card class="site-report-form-card">
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-card-title class="site-report-form-title">Site Report Form (Sample)</mat-card-title>
    <mat-divider></mat-divider>
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Date</mat-label>
        <input matInput [matDatepicker]="datePicker" formControlName="date" required>
        <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
        <mat-datepicker #datePicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Foreman Name</mat-label>
        <input matInput formControlName="foremanName" [readonly]="true">
      </mat-form-field>
    </div>
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Work Done</mat-label>
      <mat-select formControlName="workDone" required>
        <mat-option *ngFor="let option of workDoneOptions" [value]="option.id">{{ option.label }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field *ngIf="form.get('workDone')?.value && form.get('workDone')?.value !== 'other'" appearance="outline" class="full-width">
      <mat-label>Actual Quantity</mat-label>
      <input matInput type="number" formControlName="actualQuantity" min="0" required>
      <mat-error *ngIf="form.get('actualQuantity')?.hasError('required')">
        Quantity is required
      </mat-error>
      <mat-error *ngIf="form.get('actualQuantity')?.hasError('pattern')">
        Please enter a valid number
      </mat-error>
    </mat-form-field>
    <mat-form-field *ngIf="form.get('workDone')?.value === 'other'" appearance="outline" class="full-width">
      <mat-label>Specify Work Done</mat-label>
      <input matInput formControlName="workDoneOther">
    </mat-form-field>
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Notes</mat-label>
      <textarea matInput formControlName="notes" rows="2"></textarea>
    </mat-form-field>
    <mat-divider></mat-divider>
    <div class="materials-section">
      <div class="section-header">
        <span>Materials Used</span>
        <button mat-mini-fab color="primary" type="button" (click)="addMaterial()"><mat-icon>add</mat-icon></button>
      </div>
      <div formArrayName="materialsUsed">
        <div *ngFor="let mat of materialsUsed.controls; let i = index" [formGroupName]="i" class="material-row">
          <mat-form-field appearance="outline">
            <mat-label>Material</mat-label>
            <mat-select formControlName="materialId" required>
              <mat-option *ngFor="let m of materialOptions" [value]="m.id">{{ m.name }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" min="1" required>
          </mat-form-field>
          <button mat-icon-button color="warn" type="button" (click)="removeMaterial(i)"><mat-icon>delete</mat-icon></button>
        </div>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div class="photos-section">
      <div class="section-header">
        <span>Photos</span>
        <button mat-mini-fab color="primary" type="button" (click)="addPhoto()"><mat-icon>add_a_photo</mat-icon></button>
      </div>
      <div formArrayName="photos">
        <div *ngFor="let photo of photos.controls; let j = index" [formGroupName]="j" class="photo-row">
          <mat-form-field appearance="outline">
            <mat-label>Photo URL</mat-label>
            <input matInput formControlName="url" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Caption</mat-label>
            <input matInput formControlName="caption">
          </mat-form-field>
          <button mat-icon-button color="warn" type="button" (click)="removePhoto(j)"><mat-icon>delete</mat-icon></button>
        </div>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="!form.valid">Submit</button>
    </div>
  </form>
</mat-card> 